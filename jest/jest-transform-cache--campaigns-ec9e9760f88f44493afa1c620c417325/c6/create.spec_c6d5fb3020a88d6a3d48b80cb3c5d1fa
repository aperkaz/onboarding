'use strict';

var _campaigns = require('../../../client/constants/campaigns');



var _forms = require('../../../client/constants/forms');
var _notification = require('../../../client/actions/notification');
var _utils = require('../../../client/actions/campaigns/utils');
var _lodash = require('lodash');var _lodash2 = _interopRequireDefault(_lodash);
var _reduxMockStore = require('redux-mock-store');var _reduxMockStore2 = _interopRequireDefault(_reduxMockStore);
var _reduxThunk = require('redux-thunk');var _reduxThunk2 = _interopRequireDefault(_reduxThunk);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };} //import * as actions from '../../../client/actions/campaigns/create';
var actions = require('../../../client/actions/campaigns/create');var middlewares = [_reduxThunk2.default];
var mockStore = (0, _reduxMockStore2.default)(middlewares);


var mockResponse = function mockResponse(status, statusText, response) {
  return new window.Response(response, {
    status: status,
    statusText: statusText,
    headers: {
      'Content-type': 'application/json' } });


};

var store = mockStore({
  form: {
    CREATE_CAMPAIGN_FORM: {
      anyTouched: true,
      values: {
        'campaignId': "fsfs",
        'campaignType': "SupplierOnboarding",
        'companyId': null,
        'description': "dd",
        'endsOn': "2017-02-14T00:00:00.000Z",
        'owner': "john.doe@ncc.com",
        'startsOn': "2017-02-11T00:00:00.000Z",
        'status': "new" } } },



  serviceRegistry: [{
    currentApplication: true,
    location: "127.0.0.1:8080/campaigns",
    name: "campaigns" }] });



it('calls request and success actions if the fetch response was successful', function () {
  window.fetch = jest.fn().mockImplementation(function () {return (
      Promise.resolve(mockResponse(200, null, '{"campaignId":"ff"}')));});

  return store.dispatch(actions.createCampaign({})).
  then(function () {
    var expectedActions = store.getActions();
    expect(expectedActions.length).toBe(4);
    expect(expectedActions[0]).toEqual({ type: _campaigns.CAMPAIGN_CREATE_START });
    expect(expectedActions[1].type).toEqual('SHOW_NOTIFICATION');
    expect(expectedActions[3]).toEqual({ type: 'REMOVE_NOTIFICATION' });
  });
});

it('calls request and failure actions if the fetch response was not successful', function () {

  window.fetch = jest.fn().mockImplementation(function () {return Promise.resolve(mockResponse(
    400, 'Test Error', '{"status":400, "statusText": Test Error!}'));});

  return store.dispatch(actions.createCampaign({})).
  then(function () {
    var expectedActions = store.getActions();
    expect(expectedActions.length).toBe(8);
    expect(expectedActions[0]).toEqual({ type: _campaigns.CAMPAIGN_CREATE_START });
    expect(expectedActions[6].type).toEqual(_campaigns.CAMPAIGN_CREATE_ERROR);
    expect(expectedActions[7]).toEqual({ type: 'REMOVE_NOTIFICATION' });
  });
});