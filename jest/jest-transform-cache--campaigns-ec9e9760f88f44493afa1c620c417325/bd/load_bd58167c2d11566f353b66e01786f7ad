'use strict';Object.defineProperty(exports, "__esModule", { value: true });exports.









loadCampaignContacts = loadCampaignContacts;var _superagentBluebirdPromise = require('superagent-bluebird-promise');var _superagentBluebirdPromise2 = _interopRequireDefault(_superagentBluebirdPromise);var _bluebird = require('bluebird');var _bluebird2 = _interopRequireDefault(_bluebird);var _campaignContacts = require('../../constants/campaignContacts');var _notification = require('../notification');var _lodash = require('lodash');var _lodash2 = _interopRequireDefault(_lodash);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function loadCampaignContacts(campaignId) {
  return function (dispatch, getState) {
    return _bluebird2.default.resolve(
    dispatch({
      type: _campaignContacts.CAMPAIGN_CONTACTS_LOAD_START })).

    then(function () {
      return _bluebird2.default.resolve(
      dispatch((0, _notification.showNotification)('campaignContactEditor.message.info.loadingData')));

    }).then(function () {
      return _superagentBluebirdPromise2.default.get(
      _lodash2.default.find(getState().serviceRegistry, {
        currentApplication: true }).
      location + '/api/campaigns/' + campaignId + '/contacts').
      set(
      'Accept', 'application/json').
      then(
      function (response) {
        dispatch({
          type: _campaignContacts.CAMPAIGN_CONTACTS_LOAD_SUCCESS,
          campaignContacts: response.body });

      }).
      catch(function (response) {
        return _bluebird2.default.resolve(
        dispatch((0, _notification.showNotification)('campaignContactEditor.message.error.loadingData', 'error', 10, false))).
        then(function () {
          dispatch({
            type: _campaignContacts.CAMPAIGN_CONTACTS_LOAD_ERROR,
            error: response.body });

        });
      }).finally(function () {
        // removing all notifications or they will be left in 'notification queue'
        dispatch((0, _notification.removeNotification)());
      });
    });
  };
}